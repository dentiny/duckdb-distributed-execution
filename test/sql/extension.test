# name: test/sql/extension.test
# description: test duckherder extension
# group: [sql]

require duckherder

# Start distributed server in background thread
statement ok
SELECT duckherder_start_local_server(8831);

statement ok
ATTACH DATABASE 'dh' (TYPE duckherder, server_host 'localhost', server_port 8831);

statement ok
DROP TABLE IF EXISTS dh.extension_test_table;

statement ok
CREATE TABLE dh.extension_test_table (id INTEGER, name TEXT, age INTEGER);

# Validate row insertions.
statement ok
INSERT INTO dh.extension_test_table VALUES (1, 'Alice', 30), (2, 'Bob', 25), (3, 'Charlie', 40);

query III
SELECT * FROM dh.extension_test_table;
----
1	Alice	30
2	Bob	25
3	Charlie	40

# Validation row deletions.
statement ok
DELETE FROM dh.extension_test_table WHERE id=1;

query III
SELECT * FROM dh.extension_test_table;
----
2	Bob	25
3	Charlie	40

# Validate all rows deletion.
statement ok
DELETE FROM dh.extension_test_table WHERE id=2 OR id=3;

query III
SELECT * FROM dh.extension_test_table;
----

# Validate table schema, creation and drop.
query II
SELECT database_name, table_name FROM duckdb_tables();
----
dh	extension_test_table

statement ok
DROP TABLE dh.extension_test_table;

query II
SELECT database_name, table_name FROM duckdb_tables();
----
