# name: test/sql/modulo_partitioning.test
# description: Test MODULO-BASED partitioning - round-robin distribution for small datasets
# Partitioning method: (rowid % num_workers) = worker_id (fallback for small tables)
# Dataset: 6 rows using modulo partitioning as fallback
# group: [sql]

require duckherder

# Start distributed server with 4 workers
statement ok
SELECT duckherder_start_local_server(8815, 4);

statement ok
ATTACH DATABASE ':memory:' AS dh (TYPE duckherder, server_host 'localhost', server_port 8815);

statement ok
USE dh;

statement ok
PRAGMA duckherder_register_remote_table('partition_test', 'partition_test');

statement ok
DROP TABLE IF EXISTS partition_test;

statement ok
CREATE TABLE partition_test (id INTEGER, value INTEGER, category VARCHAR);

# Insert a small dataset for testing
statement ok
INSERT INTO partition_test VALUES
    (1, 100, 'A'),
    (2, 200, 'B'),
    (3, 300, 'C'),
    (4, 400, 'A'),
    (5, 500, 'B'),
    (6, 600, 'C');

# Test 1: Basic select
query III
SELECT id, value, category FROM partition_test WHERE id = 1;
----
1	100	A

# Test 2: Category filtering
query III
SELECT id, value, category FROM partition_test WHERE category = 'A';
----
1	100	A
4	400	A

# Test 3: Value filtering
query III
SELECT id, value, category FROM partition_test WHERE value = 300;
----
3	300	C

# Test 4: Multiple conditions
query III
SELECT id, value, category FROM partition_test WHERE category = 'B' AND value > 300;
----
5	500	B

