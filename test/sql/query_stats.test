# name: test/sql/query_stats.test
# description: test duckherder extension to perform remote execution
# group: [sql]

require duckherder

statement ok
SELECT duckherder_start_local_server(8815);

statement ok
ATTACH DATABASE 'dh' (TYPE duckherder, server_host 'localhost', server_port 8815);

statement ok
PRAGMA duckherder_register_remote_table('test_query_table', 'test_query_table');

statement ok
DROP TABLE IF EXISTS dh.test_query_table;

statement ok
CREATE TABLE dh.test_query_table (id INTEGER, name TEXT, age INTEGER);

statement ok
INSERT INTO dh.test_query_table VALUES (1, 'Server_Alice', 100), (2, 'Server_Bob', 200), (3, 'Server_Charlie', 300);

statement ok
DELETE FROM dh.test_query_table WHERE id=1;

statement ok
DELETE FROM dh.test_query_table WHERE id=2 OR id=3;

statement ok
DROP TABLE dh.test_query_table;

query I
SELECT COUNT(*) > 0 FROM duckherder_get_query_history();
----
true

statement ok
SELECT duckherder_clear_query_recorder_stats();

query I
SELECT COUNT(*) FROM duckherder_get_query_history();
----
0
