# name: test/sql/registration.test
# description: test duckherder extension to register and unregister table
# group: [sql]

require duckherder

statement ok
SELECT duckherder_start_local_server(8815);

statement ok
ATTACH DATABASE 'dh' (TYPE duckherder, server_host 'localhost', server_port 8815);

statement ok
PRAGMA duckherder_register_remote_table('registration_test_table', 'registration_test_table');

# Double registration.
statement error
PRAGMA duckherder_register_remote_table('registration_test_table', 'registration_test_table');
----
Invalid Input Error: Failed to register table registration_test_table because it's already registered!

statement ok
PRAGMA duckherder_unregister_remote_table('registration_test_table');

statement error
PRAGMA duckherder_unregister_remote_table('non_existent_table_xyz');
----
Invalid Input Error: Failed to unregister table non_existent_table_xyz because it hasn't been registered!

# Double unregistration.
statement error
PRAGMA duckherder_unregister_remote_table('registration_test_table');
----
Invalid Input Error: Failed to unregister table registration_test_table because it hasn't been registered!
